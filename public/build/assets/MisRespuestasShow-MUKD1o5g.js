import{v as j,r as h,U as g,j as r,$ as _,Y as v}from"./app-Be8ghtRb.js";import{A as y}from"./app-layout-BXVEw3EX.js";import{C,F as N,a as E}from"./index-BQC2eOyb.js";import{C as S,a as A,b as D,d as z,c as L}from"./card-B8jOSnGI.js";import{B as R}from"./button-D1N9RrD0.js";import{t as o}from"./index-CuSu5bUe.js";import{A as b,a as w}from"./alert-B2RiZxSE.js";import"./index-wGWY3QV4.js";import"./index-BQmSkEsW.js";import"./index-CCmhZsir.js";import"./index-Bvxqhwof.js";import"./app-logo-icon-Dxd9VO9-.js";import"./input-Co6CCOt6.js";import"./label-DPNJkhla.js";import"./textarea-B1dCnzMh.js";import"./select-B4H269ix.js";import"./index-C7CVg9dv.js";import"./checkbox-DjBb_Stx.js";import"./es-D51pjrp8.js";import"./save-D8X6UB3U.js";const F=({submittedForm:e,flash:a})=>{console.log("Datos del formulario enviado:",e);const{data:l,setData:d,patch:m,processing:x,errors:n,recentlySuccessful:u}=j({content:e.content||{}}),i=h.useMemo(()=>{if(typeof e.form.form_estructura_json=="string"&&e.form.form_estructura_json)try{const s=JSON.parse(e.form.form_estructura_json);return Array.isArray(s)?s:(console.error("Parsed form_estructura_json is not an array:",s),[])}catch(s){return console.error("Error parsing form_estructura_json:",s),[]}return Array.isArray(e.form.form_estructura_json)?e.form.form_estructura_json:[]},[e.form.form_estructura_json]),t=e.form.permite_edicion,f=async s=>{console.log("Datos para actualizar (formDataFromRenderer):",s),console.log("Datos que se enviarán:",l.content),d("content",s),l.content=s,m(route("submitted-forms.update",e.id),{onSuccess:()=>{o({title:"Respuesta actualizada",description:a.success||"La respuesta del formulario ha sido actualizada exitosamente."})},onError:c=>{var p;console.error("Errores al actualizar:",c),o({title:"Error al actualizar",description:((p=a.error)==null?void 0:p.general)||"Hubo un problema al actualizar la respuesta.",variant:"destructive"})}})};return g.useEffect(()=>{u&&a.success&&o({title:"Éxito",description:a.success})},[u,a.success,o]),r.jsxs(y,{children:[r.jsx(_,{title:`Respuesta: ${e.form.nombre}`}),r.jsx("div",{className:"py-12",children:r.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[r.jsx("div",{className:"mb-4",children:r.jsx(R,{asChild:!0,variant:"outline",children:r.jsxs(v,{href:route("formularios.mis-respuestas"),className:"flex items-center",children:[r.jsx(C,{className:"h-4 w-4 mr-2"}),"Volver a Mis Respuestas"]})})}),r.jsxs(S,{children:[r.jsxs(A,{children:[r.jsxs(D,{children:["Respuesta para: ",e.form.nombre]}),r.jsxs(z,{children:["Identificador del Formulario: ",e.form.identificador,r.jsx("br",{}),"Creado el: ",new Date(e.created_at).toLocaleString("es-ES"),t&&r.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"Editable"}),!t&&r.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Solo Lectura"})]})]}),r.jsxs(L,{children:[i&&i.length>0?r.jsx(N,{formStructure:i,initialData:e.content,readOnly:!t,onSubmit:t?f:void 0,isSubmitting:x}):r.jsx("p",{className:"text-center text-muted-foreground",children:"La estructura de este formulario no está definida o no se pudo cargar."}),n&&Object.keys(n).length>0&&r.jsxs(b,{variant:"destructive",className:"mt-4",children:[r.jsx(E,{className:"h-4 w-4"}),r.jsxs(w,{children:["Hubo errores:",r.jsx("ul",{className:"list-disc pl-5 mt-2",children:Object.values(n).map((s,c)=>r.jsx("li",{children:s},c))})]})]})]})]})]})})]})};export{F as default};
