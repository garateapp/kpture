import{v as B,r as c,U as y,j as e,$ as G,Y as L,m as O}from"./app-Be8ghtRb.js";import{A as R}from"./app-layout-BXVEw3EX.js";import{P as V,D as z,H,F as $,T as q}from"./sonner-ORFq5qYP.js";import{B as m}from"./button-D1N9RrD0.js";import{I as d}from"./input-Co6CCOt6.js";import{L as l}from"./label-DPNJkhla.js";import{C as u}from"./checkbox-DjBb_Stx.js";import{C as x,a as p,b as h,c as j}from"./card-B8jOSnGI.js";import{S as f,a as _,b as v,c as g,d as N}from"./select-B4H269ix.js";import{T as M}from"./textarea-B1dCnzMh.js";import{S as Y}from"./separator-BCfRL23H.js";import{B as J}from"./badge-DasfRpBM.js";import{t as K}from"./index-CuSu5bUe.js";import{X as U}from"./index-wGWY3QV4.js";import"./index-BQmSkEsW.js";import"./index-CCmhZsir.js";import"./index-Bvxqhwof.js";import"./app-logo-icon-Dxd9VO9-.js";import"./index-C7CVg9dv.js";function he({estados:F,tiposFormulario:S,grupos:E}){const{data:r,setData:i,processing:k,errors:s}=B({nombre:"",tipoformulario_id:"",permite_edicion:!1,identificador:"",form_estructura_json:"[]",estado_id:"",grupo_id:"",generate_pdf:!1,send_pdf_email:!1,email_recipients:[],email_subject:"",email_body:""}),[o,w]=c.useState([]),[t,b]=c.useState("");c.useEffect(()=>{i("form_estructura_json",JSON.stringify(o))},[o,i]);const D=a=>{a.preventDefault(),O.post(route("formularios.store"),r)},P=y.useCallback(a=>{w(a)},[]),T=y.useCallback(a=>{console.log("Auto-guardado en modo CREATE: Estructura actualizada en la data de Inertia.")},[]),C=()=>{t&&!r.email_recipients.includes(t)&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?(i("email_recipients",[...r.email_recipients,t]),b("")):K.error("Por favor ingresa un email válido"))},I=a=>{i("email_recipients",r.email_recipients.filter(n=>n!==a))},A=[{title:"Gestión de Formularios",href:"/formularios"},{title:"Crear Formulario",href:"/formularios/create"}];return e.jsxs(R,{breadcrumbs:A,children:[e.jsx(G,{title:"Crear Formulario"}),e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("form",{onSubmit:D,children:[e.jsxs(x,{className:"mb-6",children:[e.jsx(p,{children:e.jsx(h,{children:"Información General"})}),e.jsx(j,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"nombre",children:"Nombre del Formulario"}),e.jsx(d,{id:"nombre",type:"text",name:"nombre",value:r.nombre,className:"w-full",autoComplete:"nombre",onChange:a=>i("nombre",a.target.value),required:!0}),s.nombre&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.nombre})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"identificador",children:"Identificador (Opcional, se autogenera si está vacío)"}),e.jsx(d,{id:"identificador",type:"text",name:"identificador",value:r.identificador,className:"w-full",autoComplete:"identificador",onChange:a=>i("identificador",a.target.value)}),s.identificador&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.identificador})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"tipoformulario_id",children:"Tipo de Formulario"}),e.jsxs(f,{onValueChange:a=>i("tipoformulario_id",a),value:r.tipoformulario_id,children:[e.jsx(_,{className:"w-full",children:e.jsx(v,{placeholder:"Selecciona un tipo"})}),e.jsx(g,{children:S.map(a=>e.jsx(N,{value:a.id.toString(),children:a.nombre},a.id))})]}),s.tipoformulario_id&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.tipoformulario_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"estado_id",children:"Estado"}),e.jsxs(f,{onValueChange:a=>i("estado_id",a),value:r.estado_id,children:[e.jsx(_,{className:"w-full",children:e.jsx(v,{placeholder:"Selecciona un estado"})}),e.jsx(g,{children:F.map(a=>e.jsx(N,{value:a.id.toString(),children:a.nombre},a.id))})]}),s.estado_id&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.estado_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"grupo_id",children:"Grupo"}),e.jsxs(f,{onValueChange:a=>i("grupo_id",a),value:r.grupo_id,children:[e.jsx(_,{className:"w-full",children:e.jsx(v,{placeholder:"Selecciona un grupo"})}),e.jsx(g,{children:E.map(a=>e.jsx(N,{value:a.id.toString(),children:a.nombre},a.id))})]}),s.grupo_id&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.grupo_id})]}),e.jsxs("div",{className:"space-y-2 flex items-center col-span-full",children:[e.jsx(u,{id:"permite_edicion",checked:r.permite_edicion,onCheckedChange:a=>i("permite_edicion",a===!0)}),e.jsx(l,{htmlFor:"permite_edicion",className:"ml-2",children:"Permitir Edición después de ser completado"}),s.permite_edicion&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.permite_edicion})]})]})})]}),e.jsxs(x,{className:"mb-6",children:[e.jsx(p,{children:e.jsx(h,{children:"Configuración de PDF y Email"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"generate_pdf",checked:r.generate_pdf,onCheckedChange:a=>i("generate_pdf",a===!0)}),e.jsx(l,{htmlFor:"generate_pdf",children:"Generar PDF al completar el formulario"})]}),s.generate_pdf&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.generate_pdf}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{id:"send_pdf_email",checked:r.send_pdf_email,onCheckedChange:a=>i("send_pdf_email",a===!0)}),e.jsx(l,{htmlFor:"send_pdf_email",children:"Enviar PDF por email"})]}),s.send_pdf_email&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.send_pdf_email}),r.send_pdf_email&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Destinatarios de Email"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{type:"email",placeholder:"Ingresa un email",value:t,onChange:a=>b(a.target.value),onKeyPress:a=>{a.key==="Enter"&&(a.preventDefault(),C())}}),e.jsx(m,{type:"button",onClick:C,size:"sm",children:e.jsx(V,{className:"h-4 w-4"})})]}),r.email_recipients.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.email_recipients.map((a,n)=>e.jsxs(J,{variant:"secondary",className:"flex items-center gap-1",children:[a,e.jsx(U,{className:"h-3 w-3 cursor-pointer",onClick:()=>I(a)})]},n))}),s.email_recipients&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.email_recipients})]}),e.jsx(Y,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email_subject",children:"Asunto del Email (Opcional)"}),e.jsx(d,{id:"email_subject",type:"text",placeholder:"Ej: Nuevo formulario completado - {nombre_formulario}",value:r.email_subject,onChange:a=>i("email_subject",a.target.value)}),e.jsx("p",{className:"text-sm text-gray-500",children:'Si se deja vacío, se usará: "Nuevo Envío de Formulario: [Nombre del Formulario]"'}),s.email_subject&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.email_subject})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email_body",children:"Mensaje del Email (Opcional)"}),e.jsx(M,{id:"email_body",placeholder:"Escribe un mensaje personalizado que se incluirá en el email...",value:r.email_body,onChange:a=>i("email_body",a.target.value),rows:4}),e.jsx("p",{className:"text-sm text-gray-500",children:"Si se deja vacío, se mostrará un mensaje predeterminado con los datos del formulario."}),s.email_body&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:s.email_body})]})]})]})]}),e.jsxs(x,{children:[e.jsx(p,{children:e.jsx(h,{children:"Diseñador de Formulario"})}),e.jsx(j,{children:e.jsx(z,{backend:H,children:e.jsx($,{initialFormStructure:o,onFormStructureChange:P,onSaveFormStructure:T,autoSaveInterval:2e4})})})]}),e.jsxs("div",{className:"flex items-center justify-end mt-6",children:[e.jsx(L,{href:route("formularios.index"),children:e.jsx(m,{variant:"outline",className:"mr-4",children:"Cancelar"})}),e.jsx(m,{type:"submit",disabled:k,children:"Crear Formulario"})]})]})}),e.jsx(q,{})]})}export{he as default};
